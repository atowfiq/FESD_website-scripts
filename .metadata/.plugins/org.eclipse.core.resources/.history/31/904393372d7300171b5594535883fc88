<%@ page language="java" contentType="text/html; charset=ISO-8859-1"
    pageEncoding="ISO-8859-1"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Bandstructure</title>

<style type="text/css">
.main{
margin-top:-40px;
}


.modal .modal-body {
    max-height: 800px;
    overflow-y: auto;
}
.modal {
  text-align: center;
}

@media screen and (min-width: 768px) {
  .modal:before {
    content: " ";
    display: inline-block;
    height: 100%;
    vertical-align: middle;
  }
}

.modal-dialog {
  display: inline-block;
  text-align: center;
  vertical-align: middle;
}

</style>

    <script type="text/javascript">
      
      function drawChart(bands) {  
    	//  $("#Bands").append($("<option></option>").val('All').html('All'));
     	  $.each(bands, function (key, value) {

 	         $("#BandsFrom").append($("<option></option>").val(value.Index).html(value.Index));
 	        $("#BandsTo").append($("<option></option>").val(value.Index).html(value.Index));
 	 	        
     	  });
     	  
     	 drawBandChart(bands);
     	  
          }
      
      	  function drawBandChart(bands)
      	  {
      		
       	  
      	  BandChart = document.getElementById('BandChart');
      	  Plotly.purge(BandChart);
  		
      	  var data =[];
      	  var dx=[];
    	  for(var i=0;i<bands[0].Energy.split(", ").length;i++)
    	         	  dx.push(i);
      	  for(var l=0;l<bands.length;l++)
      		{
      	
      		  data.push({x:dx,y:bands[l].Energy.split(", ")});
      		}
      	  /* [{
      	      x: [1, 2, 3, 4, 5],
      	      y: [1, 2, 4, 8, 16],
      	  	},{
      	      x: [1, 2, 3, 4, 5],
      	      y: [2, 4, 6, 8, 16],
      	  	}]*/

      	 var layout = {
       			  title: 'Bandstructure' + Compound.Formula,
       			 
       			  yaxis: {
       			    range: [-10, 10],
       			    autorange: false
       			  },
       			  
       			};
      	  Plotly.plot( BandChart,data, layout );
      	  }
      	  
      	  function drawChartSingleBand(index,bands,orbitalValue)
      	  {
      		  
      		  
      		 
      		 BandChart = document.getElementById('BandChart');
      		 Plotly.purge(BandChart);
      		
      		 var data =[];
         	  var dx=[];
         	  for(var i=0;i<bands[index].Energy.split(", ").length;i++)
         		  dx.push(i);
         	 
         	var weight= orbitalValue.split(", ");
         	
         	
         	// data.push({x:dx,y:bands[index].Energy.split(", ")});
         	  data.push({x:dx,
         			  y:bands[index].Energy.split(", "),
         			  type: 'scatter',                    // set the chart type
        		      mode: 'lines',   
        		      line: {                             // set the width of the line.
        		         width: 1
        		      },
        		      
        		      error_y: {
        		        array: weight.map(function(x) { return x ; }),
        		        thickness: 0.5,                   // set the thickness of the error bars
        		        width: 0
        		      }
         		  
         		  
         		  });
         	  
       

         	  Plotly.plot( BandChart,data, { 
         	      margin: { t: 0 } } );
 
      		  
      		  
      	  }
      	
      	function GetBandstructures()
      	{
      		var bandsFrom=$("#BandsFrom").val(),bandsTo =$("#BandsTo").val(); 
      		if(bandsFrom>bandsTo)
      		{
      			alert("Bands from should be less than bands to.");
      			return;
      		}
      		$.get('BandStructureServlet', {
      			from: bandsFrom,
      			to: bandsTo,
      			id:Compound.Id
      			 }, function(data) { 
      				 $("#CompoundElements").html(''); 
      				    $("#CompoundElements").append($("<option></option>").val("None").html("None"));
      			  	     $.each(data, function (key, value) {
      		     		  
      			  	         $("#CompoundElements").append($("<option></option>").val(JSON.stringify({Header: value.Header,PartialEnergy:value.PartialEnergy})).html(value.Element+" "+value.ElementIndex));
      			  	       });
      		     	  
      		     	  

      		});


      		
      	}
     
  	
    </script>

</head>
<body>
<div  id="Viewer"  class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" style="width:100%">
    <div class="modal-dialog modal-lg">
     
      <!-- Modal content-->
      
       
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title" id="CompoundFormulaName"></h4>
          
        </div>
        <div class="modal-body">
    <div>
    <td>
<label  class="control-label">Emin:</label><input id="EminBC" style="width:150px;" class="form-control" value="-10">
</td>
<td>
<label  class="control-label">Emax:</label><input id="EmaxBC" style="width:150px;" class="form-control" value="10">
</td>
	
	</div>
	<button style="width:180px;" class="btn btn-secondary" onclick="GetBandstructures()">Get BandStructures</button>
	
   <div id="BandChart" style="width: 900px; height: 500px"></div>
   
   
 <label  class="control-label ">Element </label> <select style="width: 100px; "  id="CompoundElements">
			
		</select> 
		<label  class="control-label ">Orbital</label> <select style="width: 150px; "  id="Orbitals">
			
		</select>
<div id="ViewerContent"  style="display: none;"> <img src="" id="imagepreview" style="padding: 5px; width: 800px; height: 600px;" ></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
      
    </div>
  </div>
  

</body>
</html>