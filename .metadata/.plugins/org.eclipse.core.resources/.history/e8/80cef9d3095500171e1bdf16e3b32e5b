<%@ page language="java" contentType="text/html; charset=ISO-8859-1"
    pageEncoding="ISO-8859-1"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Compound </title>

 <link rel="stylesheet" href="css/ChemDoodleWeb.css" type="text/css">
 <script type="text/javascript" src="js/ChemDoodleWeb.js"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
<script src="js/jquery.tmpl.js" type="text/javascript"></script> 
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script type="text/javascript">
      
      function drawChart(bands) {
    	  
    	  $("#Bands").html('')
    	  
    	  $("#Bands").append($("<option></option>").val('All').html('All'));
     	  $.each(bands, function (key, value) {

 	         $("#Bands").append($("<option></option>").val(value.Index).html(value.Index));
 	        });
     	 drawBandChart(bands);
     	  
          }
      
      	  function drawBandChart(bands)
      	  {
      		
       	  
      	  BandChart = document.getElementById('BandChart');
      	  Plotly.purge(BandChart);
  		
      	  var data =[];
      	  var dx=[];
    	  for(var i=0;i<bands[0].Energy.split(", ").length;i++)
    	         	  dx.push(i);
      	  for(var l=0;l<bands.length;l++)
      		{
      	
      		  data.push({x:dx,y:bands[l].Energy.split(", ")});
      		}
      	  /* [{
      	      x: [1, 2, 3, 4, 5],
      	      y: [1, 2, 4, 8, 16],
      	  	},{
      	      x: [1, 2, 3, 4, 5],
      	      y: [2, 4, 6, 8, 16],
      	  	}]*/

      	  Plotly.plot( BandChart,data, { 
      	      margin: { t: 0 } } );
      	  }
      	  
      	  function drawChartSingleBand(index,bands)
      	  {
      		 
      		 BandChart = document.getElementById('BandChart');
      		Plotly.purge(BandChart);
      		
      		 var data =[];
         	  var dx=[];
         	  for(var i=0;i<bands[index].Energy.split(", ").length;i++)
         		  dx.push(i);
         	 
         	var tot = "0.86421, 0.86422, 0.86423, 0.86426, 0.86430, 0.86436, 0.86442, 0.86449, 0.86457, 0.86466, 0.86477, 0.86489, 0.86502, 0.86516, 0.86531, 0.86546, 0.86563, 0.86580, 0.86598, 0.86617, 0.86636, 0.86656, 0.86677, 0.86699, 0.86721, 0.86744, 0.86766, 0.86789, 0.86812, 0.86835, 0.86858, 0.86881, 0.86905, 0.86928, 0.86951, 0.86972, 0.86995, 0.87017, 0.87040, 0.87062, 0.87083, 0.87104, 0.87124, 0.87143, 0.87162, 0.87180, 0.87197, 0.87213, 0.87228, 0.87242, 0.87256, 0.87268, 0.87279, 0.87287, 0.87296, 0.87304, 0.87311, 0.87317, 0.87321, 0.87324, 0.87325, 0.87325, 0.87326, 0.87326, 0.87326, 0.87326, 0.87326, 0.87326, 0.87326, 0.87326, 0.87326, 0.87326, 0.87326, 0.87328, 0.87328, 0.87328, 0.87328, 0.87328, 0.87328, 0.87327, 0.87327, 0.87327, 0.87327, 0.87328, 0.87329, 0.87329, 0.87329, 0.87329, 0.87329, 0.87329, 0.87328, 0.87328, 0.87328, 0.87328, 0.87327, 0.87327, 0.87326, 0.87325, 0.87325, 0.87323, 0.87322, 0.87321, 0.87319, 0.87317, 0.87316, 0.87315, 0.87312, 0.87311, 0.87310, 0.87309, 0.87309, 0.87308, 0.87308, 0.87307, 0.87306, 0.87304, 0.87301, 0.87297, 0.87293, 0.87288, 0.87282, 0.87276, 0.87270, 0.87263, 0.87256, 0.87248, 0.87242, 0.87234, 0.87226, 0.87218, 0.87210, 0.87201, 0.87193, 0.87185, 0.87176, 0.87169, 0.87161, 0.87154, 0.87147, 0.87141, 0.87134, 0.87129, 0.87123, 0.87118, 0.87114, 0.87111, 0.87108, 0.87105, 0.87103, 0.87101, 0.87103, 0.87102, 0.87103, 0.87102, 0.87103, 0.87105, 0.87106, 0.87110, 0.87114, 0.87118, 0.87123, 0.87128, 0.87134, 0.87140, 0.87147, 0.87154, 0.87161, 0.87167, 0.87175, 0.87183, 0.87191, 0.87199, 0.87208, 0.87217, 0.87225, 0.87234, 0.87242, 0.87250, 0.87258, 0.87265, 0.87272, 0.87279, 0.87286, 0.87292, 0.87299, 0.87304, 0.87309, 0.87314, 0.87317, 0.87321, 0.87323, 0.87326, 0.87327, 0.87328, 0.87328, 0.87328, 0.87327, 0.87327, 0.87326, 0.87325, 0.87325, 0.87323, 0.87322, 0.87321, 0.87319, 0.87317, 0.87316, 0.87315, 0.87312, 0.87311, 0.87310, 0.87309, 0.87309, 0.87308, 0.87308, 0.87307, 0.87306, 0.87307, 0.87307, 0.87307, 0.87305, 0.87302, 0.87299, 0.87294, 0.87289, 0.87282, 0.87275, 0.87267, 0.87258, 0.87248, 0.87237, 0.87225, 0.87212, 0.87198, 0.87183, 0.87168, 0.87152, 0.87134, 0.87117, 0.87098, 0.87080, 0.87060, 0.87041, 0.87020, 0.86999, 0.86979, 0.86957, 0.86935, 0.86914, 0.86892, 0.86869, 0.86847, 0.86824, 0.86802, 0.86780, 0.86758, 0.86736, 0.86715, 0.86693, 0.86673, 0.86653, 0.86633, 0.86614, 0.86596, 0.86577, 0.86560, 0.86544, 0.86529, 0.86514, 0.86501, 0.86488, 0.86476, 0.86466, 0.86457, 0.86448, 0.86442, 0.86435, 0.86430, 0.86426, 0.86423, 0.86422, 0.86421";
 			var totArr = tot.split(", ");
         	// data.push({x:dx,y:bands[index].Energy.split(", ")});
         	  data.push({x:dx,
         			  y:bands[index].Energy.split(", "),
         			  type: 'scatter',                    // set the chart type
        		      mode: 'lines',   
        		      line: {                             // set the width of the line.
        		         width: 1
        		      },
        		      
        		      error_y: {
        		        array: ,
        		        thickness: 0.5,                   // set the thickness of the error bars
        		        width: 0
        		      }
         		  
         		  
         		  });
         	  Plotly.plot( BandChart,data, { 
         	      margin: { t: 0 } } );
 
      		  
      		Compound.BandStructures[index-1];
      		  
      	  }
      	
     
  	
    </script>
<script type="text/javascript">

$(document).ready(function(){
		
	
	
	$.get('SingleCompoundServlet', {
		Id: <%=request.getParameter("Id")%> 
		 }, function(compound) { 
			 compound.BSExists=true;
			 Compound= compound;
			
			LoadCif(compound.Cif); 
		//	$("#cifViz").html(new String(compound.Cif));
				
			 
			 $("#CompoundName").text(compound.Formula);
			
			 
		//	 $("#CompoundDetailsContent").html('');			
			$("#CompoundDetailsTemplate").tmpl(compound).appendTo("#CompoundDetailsContent");

	//			$("#CompoundContent").html('');			
		//		$("#CompoundListTemplate").tmpl(compoundList).appendTo("#CompoundContent");

	
	});
	$('#Bands').change(function() {
		if($(this).val()=='All')
			drawBandChart(Compound.BandStructures);
		else
			drawChartSingleBand($(this).val(),Compound.BandStructures);
		});
	
});
function LoadCif(cif)
{
	var MAZfile = cif;// you can change the 1s here to generate a supercell
	var maz = ChemDoodle.readCIF(MAZfile, 1, 1, 1);

	//setup component
	var crystalTransformer = new ChemDoodle.TransformCanvas3D('mol-canvas', 500, 500);
	// set the atom/bond representation to 'Ball and Stick', although other representations are also useful for zeolites
	crystalTransformer.specs.set3DRepresentation('Ball and Stick');
	// set the background color to black
	crystalTransformer.specs.backgroundColor = '#000000';
	// declare an orthographic perspective to more easily see the zeolite pattern
	crystalTransformer.specs.projectionPerspective_3D = false;
	// set the line widths for the unit cell to be 1.5 pixels
	crystalTransformer.specs.crystals_unitCellLineWidth = 1.5;
	// set the unit cell line color to white
	crystalTransformer.specs.shapes_color = 'white';
	// set the unit cell line width to 2
	crystalTransformer.specs.shapes_lineWidth = 2;
	crystalTransformer.specs.atoms_displayLabels_3D = true;

	 

	  
	  crystalTransformer.loadContent([maz.molecule], [maz.unitCell]);

}

function ViewCIF()
{
	var s = Compound.Cif.replace(/(?:\r\n|\r|\n)/g, '<br />');
	$('#CompoundFormula').text(Compound.Formula);	

	$('#CifModal').modal();	
	$('#content').html(s);
}

function DownloadCIF()
{
	var downloadId;	
	if(Compound.Source ='cod')
		downloadId = Compound.CodID;
	else
		downloadId =  Compound.ICSDID;
	window.location = 'CIFServlet?downloadId='+downloadId+"&source="+Compound.Source;
}






function ViewCompoundProperties(propType)
{
	$('#CompoundFormulaName').text(Compound.Formula);	

	var src = '../static/View/';
	var srcId = '';
	if (Compound.Source=='cod')
		srcId  = Compound.CodID;
	else 
		srcId  = Compound.ICSDID;
	if(propType=='dos1'){
		src = src + 'dos/'+Compound.Source+'/'+srcId+'100.png';
			
	}
	if(propType=='dos2'){		
		src = src + 'dos/'+Compound.Source+'/'+srcId+'200.png';
	}
	if(propType=='dos3'){
		src = src + 'dos/'+Compound.Source+'/'+srcId+'300.png';
			
	}
	
	else if(propType=='bs')
	{
	//	src = src + 'bandstructure/'+Compound.Source+'/'+srcId+'.spaghetti_ps00.png';
		
	}
	else if(propType=='fs')
	{
		src = '';
		
	}
	else if(propType=='hf')
	{
		src = 'DataImage/hf.png';
		
	}
	
	$('#Viewer').modal();	
//	$('#ViewerContent').html(propType);
     $('#imagepreview').attr('src', src);   
     $('#Viewer').on('shown.bs.modal', function () {
    	
	  

    	 drawChart(Compound.BandStructures);
    	});
}


</script>


<script id="CompoundDetailsTemplate"  type="text/x-jquery-tmpl">




<td>
<table class="table table-striped">
<tr>
	<td><strong>Source</strong></td>	
	<td>{{html Source}} - {{if Source == "cod"}}{{html CodID}}
{{/if}}
{{if Source == "icsd"}}{{html ICSDID}}
{{/if}}
</td>
</tr>
<tr>
	<td><strong>Formula</strong></td>	
	<td>{{html Formula}}</td>
</tr>
<tr>
	<td><strong>Space Group</strong></td>
		<td>{{html SpaceGroup}}</td>

</tr>
<tr>
	<td><strong>Crystal System</strong></td>
		<td>{{html CrystalSystem}}</td>

</tr>
<tr>
	<td><strong>Space Group Name</strong></td>
		<td>{{html SpaceGroupName}}</td>

</tr>
<tr>
	<td><strong>Space Group Name Hall</strong></td>
		<td>{{html SymmetrySpaceGroupNameHall}}</td>

</tr>
<tr>
	<td><strong>Cell Angle Alpha</strong></td>
		<td>{{html CellAngleAlpha}}</td>
</tr>
<tr>
	<td><strong>Cell Length A</strong></td>
		<td>{{html CellLengthA}}</td>
</tr>
<tr>
	<td><strong>Cell Length B</strong></td>
		<td>{{html CellLengthB}}</td>

</tr>
<tr>
	<td><strong>Cell Length C</strong></td>
		<td>{{html CellLengthC}}</td>

</tr>
<tr>
	<td><strong>Volume</strong></td>
		<td>{{html CellVolume}}</td>

</tr>

{{if BSExists}}
<tr>
<td><strong>BandStructure</strong></td>
<td><button style="width:180px;" class="btn btn-secondary" onclick="ViewCompoundProperties('bs')">BandStructure</button></td>
</tr>
{{/if}}	 

{{if Dos1Exists}}
<tr>
<td><strong>Dos 1</strong></td>
<td><button style="width:180px;" class="btn btn-secondary" onclick="ViewCompoundProperties('dos1')">Dos 1</button></td>
</tr>
{{/if}}	 

{{if Dos2Exists}}
<tr>
<td><strong>Dos 2</strong></td>
<td><button style="width:180px;" class="btn btn-secondary" onclick="ViewCompoundProperties('dos2')">Dos 2</button></td>
</tr>
{{/if}}
{{if Dos3Exists}}
<tr>
<td><strong>Dos 3</strong></td>
<td><button style="width:180px;" class="btn btn-secondary" onclick="ViewCompoundProperties('dos3')">Dos 3</button></td>
</tr>
{{/if}}	 


<tr>
<td><strong>CIF</strong></td>
<td>
<a style="cursor: pointer;" onclick="ViewCIF();">View</a> 
</td>
</tr>
<tr>
<td colspan=2>
<h4>Coming Soon!</h4>
 <img src="image/uc.jpg" style="width: 200px; height: 100px;" >
 
</td>

</tr>

<tr>
<td colspan=2>
 
Automated DFT calculations on <span style="color: red;">80000</span> f-electron compounds
</td>

</tr>

</table>
</td>
	
</script>	


<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">
<style type="text/css">
.main{
margin-top:-40px;
}


.modal .modal-body {
    max-height: 800px;
    overflow-y: auto;
}
.modal {
  text-align: center;
}

@media screen and (min-width: 768px) {
  .modal:before {
    content: " ";
    display: inline-block;
    height: 100%;
    vertical-align: middle;
  }
}

.modal-dialog {
  display: inline-block;
  text-align: center;
  vertical-align: middle;
}

</style>
<script>
function goBack() {
    window.history.back();
}
</script>
</head>
<body>
<jsp:include page="topBar.jsp"/>
<jsp:include page="leftSidebar.jsp"/>
<div class="main">


<div class="page-header">
	<h1><span id='CompoundName'></span> </h1>
</div>

	<div style="float:right;"><button class="btn btn-secondary" onclick="goBack()">Go Back</button></div>	    

	<div style="clear:both;"></div>
	
	
	
		    <table style="padding-top: 10px;" class="table" >
	    <tbody >
	   
	    <tr id="CompoundDetailsContent"><td></td>
	    <td >
	    	 <figure> 
			
			<canvas id="mol-canvas"></canvas>
  			</figure>
	    
	    </td></tr>
	    </tbody>
	    </table>


<div  id="CifModal"  class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
    <div class="modal-dialog modal-lg">
     
      <!-- Modal content-->
      
       
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title" id="CompoundFormula"></h4>
        </div>
        <div class="modal-body">
       
<div id="content" ></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
      
    </div>
  </div>
  	
	<div  id="Viewer"  class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" style="width:100%">
    <div class="modal-dialog modal-lg">
     
      <!-- Modal content-->
      
       
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title" id="CompoundFormulaName"></h4>
          
        </div>
        <div class="modal-body">
    <label  class="control-label ">Bandstructures</label> <select style="width: 150px; "  id="Bands">
			
		</select>
   <div id="BandChart" style="width: 900px; height: 500px"></div>
<div id="ViewerContent"  style="display: none;"> <img src="" id="imagepreview" style="padding: 5px; width: 800px; height: 600px;" ></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
      
    </div>
  </div>
  
</div>


</body>
</html>